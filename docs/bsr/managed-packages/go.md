---
id: go
title: Go
---

:::note

The alpha [Go documentation](../../reference/deprecated/remote-generation/go.md) has moved to the Reference section.

:::


The [Buf Schema Registry](../../bsr/overview.md) (BSR) supports serving generated SDKs for [Go].
With this feature, you can push [Buf modules][modules] to the BSR and `go get` Go code stubs generated
from those Protobuf definitions&mdash;without ever needing to generate code on your own. Go source code
generated by the BSR is served via the BSR's [Go module proxy](#proxy).

This feature is especially useful for creating API clients for Go, as it provides consumers of your
API with generated Go SDKs on demand. With generated SDKs, you no longer need to generate Go code
from Protobuf locally, and thus no longer need to maintain Protobuf files or protoc-based plugins.

## BSR Go module proxy {#proxy}

The BSR Go module proxy implements the [GOPROXY protocol][goproxy] for [Buf modules][modules] by
generating assets on the fly&mdash;Go code stubs aren't generated until you request them using
`go get`. Once generated they are cached and the cached assets are returned from then on.

The key to consuming from the BSR Go module proxy is choosing the right **Go module path**. The
import path for generated Go code has this format:

import Syntax from "@site/src/components/Syntax";

<Syntax
title="Generated Go module path syntax"
examples={[
"buf.build/gen/go/bufbuild/eliza/library/connect-go"
]}
segments={[
{"label": "buf.build/gen/go", "kind": "constant"},
{"separator": "/"},
{"label": "moduleOwner", "kind": "variable", href: "/bsr/overview#modules"},
{"separator": "/"},
{"label": "moduleName", "kind": "variable", href: "/bsr/overview#modules"},
{"separator": "/"},
{"label": "pluginOwner", "kind": "variable", href: "#proxy"},
{"separator": "/"},
{"label": "pluginName", "kind": "variable", href: "#proxy"},
]}
/>

So if you wanted to, for example, generate the [`acme/paymentapis`][api] Protobuf module using the
[`connect-go`][connect-go] plugin, you could install the generated code like this:

```terminal
$ go get buf.build/gen/go/acme/paymentapis/library/connect-go
---
go: downloading buf.build/gen/go/acme/paymentapis/library/connect-go v0.4.0-20220907172603-9a877cf260e1.3
go: added buf.build/gen/go/acme/paymentapis/library/connect-go v0.4.0-20220907172603-9a877cf260e1.3
```

You can use _any_ plugin that generates Go, which can simplify Protobuf workflows down to two
steps:

1. `buf push` your [module][modules] to the BSR
1. `go get` your generated Go module

## Module versions

By default, when you `go get` a [Buf module][modules], the BSR generates code from the most recent [reference](../overview.md#referencing-a-module) for the module. But you can also install a specific module version using `go get`'s `@` syntax referencing an explicit version or a draft name.

#### Latest version

Get the generated asset for the latest version of the module.

```terminal
$ go get buf.build/gen/go/acme/paymentapis/library/connect-go@latest
```

#### Commit

Get the generated asset for the module at a commit.

```terminal
$ go get buf.build/gen/go/acme/paymentapis/library/connect-go@9a877cf260e1488d869a31fce3bea26d
```

#### Tag

Get the generated asset for the module at a tag.

```terminal
$ go get buf.build/gen/go/acme/paymentapis/library/connect-go@foo
```

#### Draft

Get the generated asset for the module at a draft.

```terminal
$ go get buf.build/gen/go/acme/paymentapis/library/connect-go@feature-1
```

### Version syntax

<Syntax
title="Go module version syntax"
examples={["0.2.1-20220706172350-dbde79169a01.3"]}
segments={[
{label: "pluginVersion", kind: "variable"},
{separator: "-"},
{label: "moduleTimestamp", kind: "variable"},
{separator: "-"},
{label: "moduleCommit", kind: "variable"},
{separator: "."},
{label: "pluginRevision", kind: "variable"}
]
} />

With package versions (valid [semver][semver]):

* The version core is the plugin version **0.2.1**
* The semver pre-release version is composed of:
    * module commit timestamp (YYYYMMDDHHMMSS) **20220706172350**
    * module commit short name (12 characters) **dbde79169a01**
* The final identifier is the plugin revision **3** for the plugin version

Most users will likely use `@latest`, but if you need to reference a package version explicitly you can do so like this:

```terminal
$ go get buf.build/gen/go/acme/paymentapis/library/connect-go@0.2.1-20220706172350-dbde79169a01.3
```

## Try it out!

In this example, we'll use the Go [Connect][connect] client for the [Eliza demo][connect-demo] service. Since
this is a Protobuf API we get a generated client SDK with minimal effort. The
[`connect-go`][connect-go] plugin is used to generate the [`bufbuild/eliza`][eliza-module] module.

See the [above](#proxy) for a refresher on Go module import paths.

Start by initializing an empty `go.mod` file using:

```terminal
$ go mod init main
```

Add `main.go` with the following contents:

```go {10,11}
package main

import (
    "context"
    "fmt"
    "log"
    "net/http"

    // Import the Eliza API definitions generated using the plugins library/go and library/connect-go.
    "buf.build/gen/go/bufbuild/eliza/library/connect-go/buf/connect/demo/eliza/v1/elizav1connect"
    elizav1 "buf.build/gen/go/bufbuild/eliza/library/go/buf/connect/demo/eliza/v1"
    "github.com/bufbuild/connect-go"
)

func main() {
    client := elizav1connect.NewElizaServiceClient(http.DefaultClient, "https://demo.connect.build")
    resp, err := client.Say(context.Background(), connect.NewRequest(&elizav1.SayRequest{
        Sentence: "Hello!",
    }))
    if err != nil {
        log.Fatalf("Failed to say hello: %v", err)
    }
    fmt.Println(resp.Msg.Sentence)
}
```

Run the module tidy command:

```terminal
$ go mod tidy
---
go: downloading buf.build/gen/go/bufbuild/eliza/library/go v1.28.1-20220706172350-dbde79169a01.7
go: downloading buf.build/gen/go/bufbuild/eliza/library/connect-go v0.4.0-20220706172350-dbde79169a01.3
```

You'll observe versions such as `v1.2.0-20220706172350-dbde79169a01.2` in the `go.mod` file. To
better understand versioning, see the generated asset versions documentation.

```sh title="go.mod"
module main

go 1.19

require (
    buf.build/gen/go/bufbuild/eliza/library/connect-go v0.4.0-20220706172350-dbde79169a01.3
    buf.build/gen/go/bufbuild/eliza/library/go v1.28.1-20220706172350-dbde79169a01.7
    github.com/bufbuild/connect-go v0.4.0
)

require google.golang.org/protobuf v1.28.1 // indirect

```

Run the program:

```terminal
$ go run .
---
Hello...I'm glad you could drop by today.
```

## Generate private modules {#private}

To generate Go code from private modules you'll need to make sure the Go tooling is correctly configured.

1. Log into the BSR:

   The `go` tool uses [`.netrc` credentials][netrc] if available and you can use `buf registry login` to add this to your `.netrc` file.
   You can obtain an API token (password) from the [Settings page][settings].

    ```terminal
    $ buf registry login
    ```

    ```sh title="~/.netrc"
    machine buf.build
            login <USERNAME>
            password <TOKEN>
    ```

2. Go Environment Configuration

   The `GOPRIVATE` environment variable controls which modules the `go` command considers to be
   private and thus shouldn't use the proxy or checksum database. This is important since you don't
   want to send private information to the default Go module proxy at https://proxy.golang.org.

   Set this environment variable:

    ```terminal
    $ export GOPRIVATE=buf.build/gen/go
    ```

   If you already have `GONOSUMDB` configured, you also need to add `buf.build/gen/go` to it:

    ```terminal
    $ export GONOSUMDB=$GONOSUMDB,buf.build/gen/go
    ```

   This isn't necessary if you do not already have `GONOSUMDB` configured, as `GOPRIVATE`
   automatically sets it in this case.

   For more information, see the official [private modules documentation][private].

[api]: https://buf.build/acme/paymentapis
[go]: https://golang.org
[eliza-module]: https://buf.build/bufbuild/eliza/
[connect]: https://connect.build
[connect-demo]: https://github.com/bufbuild/connect-demo
[connect-go]: https://buf.build/library/connect-go
[goproxy]: https://golang.org/ref/mod#goproxy-protocol
[modules]: ../overview.md#modules
[netrc]: https://golang.org/ref/mod#private-module-proxy-auth
[private]: https://golang.org/ref/mod#private-modules
[settings]: https://buf.build/settings/user
